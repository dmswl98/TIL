# ğŸ–±ï¸ ë¬´í•œ ìŠ¤í¬ë¡¤ êµ¬í˜„

## ë¬´í•œ ìŠ¤í¬ë¡¤ì´ë€?

> ì»¨í…ì¸ ë¥¼ í˜ì´ì§•í•˜ëŠ” ê¸°ë²• ì¤‘ í•˜ë‚˜ë¡œ ìŠ¤í¬ë¡¤ì„ ì´ìš©í•´ ë§¨ ì•„ë˜ê¹Œì§€ ë„ë‹¬í•  ë•Œ ìƒˆë¡œìš´ ì»¨í…ì¸ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë°©ì‹ì„ ë§í•œë‹¤.

- ë§Œì•½ footerì— ì»¨í…ì¸ ê°€ ìˆëŠ” ê²½ìš°, ë¬´í•œ ìŠ¤í¬ë¡¤ë¡œ ì¸í•´ footerì— ì ‘ê·¼í•˜ì§€ ëª»í•˜ëŠ” ìƒí™©ì´ ë°œìƒí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë¬´í•œ ìŠ¤í¬ë¡¤ ëŒ€ì‹  'ë”ë³´ê¸°'ì™€ ê°™ì€ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë°ì´í„°ë¥¼ ì¶”ê°€ë¡œ ë¶ˆëŸ¬ì˜¤ëŠ” ë°©ì‹ì´ ë” ì¢‹ë‹¤.

## êµ¬í˜„ ë°©ì‹

> ìŠ¤í¬ë¡¤ì„ ëê¹Œì§€ ë‚´ë ¸ì„ ë•Œ fetchëœ ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ì—˜ë¦¬ë¨¼íŠ¸ì— ê³„ì† ì¶”ê°€(appendChild)í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•œë‹¤. êµ¬í˜„ ë°©ì‹ì€ í¬ê²Œ ë‘ ê°€ì§€ì´ë‹¤.

## 1. scroll ì´ë²¤íŠ¸ ì´ìš©

- ì „í†µì ì¸ ë°©ì‹
- windowì˜ scroll ì´ë²¤íŠ¸ê°€ ì¼ì–´ë‚  ë•Œë§ˆë‹¤ ë¸Œë¼ìš°ì € í™”ë©´ì˜ ë†’ì´, ìŠ¤í¬ë¡¤ë°”ì˜ ìœ„ì¹˜ë¥¼ ì´ìš©í•´ body(ì»¨í…ì¸ )ì˜ ëê¹Œì§€ ë‹¤ë‹¤ëìœ¼ë©´ ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë°©ì‹ì„ ë§í•œë‹¤.

- `window.innerHeight` : í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë³´ì—¬ì§€ëŠ” í™”ë©´ ì¤‘ íƒ­, url ì£¼ì†Œì°½, ë¶ë§ˆí¬ íƒ­ì„ ì œì™¸í•œ ë¸Œë¼ìš°ì €ì˜ ë†’ì´
- `window.scrollY` : í˜„ì¬ ìŠ¤í¬ë¡¤ë°” ìœ„ì¹˜
- `document.body.offsetHeight` : bodyì˜ height
- `window.innerHeight + window.scrollY` : (íƒ­, url ì£¼ì†Œì°½, ë¶ë§ˆí¬ íƒ­ì„ ì œì™¸í•œ)ë¸Œë¼ìš°ì €ì˜ ë†’ì´ + ì‚¬ìš©ìì˜ ìŠ¤í¬ë¡¤ Y ê°’
- `window.innerHeight + window.scrollY` ê°’ì´ í˜„ì¬ bodyì˜ ë†’ì´ ê°’ë³´ë‹¤ ê°™ê±°ë‚˜ í° ê²½ìš° ìƒˆ ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì´ë‹¤.

```javascript
window.addEventListener("scroll", () => {
  // 100ì„ ë”í•˜ë©´ ìŠ¤í¬ë¡¤ì„ ëê¹Œì§€ ë‚´ë¦¬ê¸° 100px ì „ì— ë°ì´í„°ë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆë‹¤.
  const isScrollEnded =
    window.innerHeight + window.scrollY + 100 >= document.body.offsetHeight;

  // totalCount : apiì˜ ë°ì´í„°ì˜ ì „ì²´ ê¸¸ì´
  // photos.length: í˜„ì¬ ëœë”ë§ëœ ë°ì´í„°ì˜ ê¸¸ì´
  const { photos, totalCount, isLoading } = this.state;
  if (isScrollEnded && !isLoading && photos.length < totalCount) {
    onScrollEnded();
  }
});
```

1. isLoadingì˜ ìƒíƒœ ì¡´ì¬ ì´ìœ 

- ë°ì´í„°ë¥¼ ì´ë¯¸ ìš”ì²­í–ˆìŒì—ë„ ê³„ì† ë°ì´í„°ë¥¼ ìš”ì²­í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤.
  ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d7f6ef74-9be0-4b94-a4dc-ea9189361f07/Untitled.png)
- ì´ ê²½ìš° isLoading ìƒíƒœë¥¼ ë‘ì–´ ë°ì´í„°ë¥¼ ìš”ì²­í•˜ê³  ì‘ë‹µë°›ê¸° ì „ê¹Œì§€ëŠ” ì¬ìš”ì²­ì„ í•˜ì§€ ì•Šë„ë¡ í•  ìˆ˜ ìˆë‹¤.

2. totalCountì˜ ì¡´ì¬ ì´ìœ 

- ì´ë¯¸ apiì˜ ë§ˆì§€ë§‰ ë°ì´í„°ê¹Œì§€ ëª¨ë‘ ê°€ì ¸ì™”ìŒì—ë„ ë¶ˆêµ¬í•˜ê³  1) ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ ë‚´ë¦° ìƒíƒœ, 2) isLoadingì´ falseì¸ ê²½ìš°, ì´ ë‘ ê°€ì§€ê°€ ì°¸ì¼ ë•Œ ê³„ì† ìš”ì²­ì„ ë³´ë‚´ëŠ” ìƒí™©ì´ ë°œìƒí•œë‹¤.
- ì´ ê²½ìš° apiì˜ ë°ì´í„° ì „ì²´ ê°œìˆ˜(totalCount)ì™€ í˜„ì¬ê¹Œì§€ ëœë”ë§ëœ ë¦¬ìŠ¤íŠ¸ì˜ ê°œìˆ˜(photos.length)ë¥¼ ë¹„êµí•´ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

<br />
<br />

## 2. Intersection Observer

- ìµœê·¼ ë°©ì‹
- observe, unobserveë¥¼ ì‚¬ìš©í•´ êµ¬í˜„í•œë‹¤.
- threshold ê°’ìœ¼ë¡œ observe ëŒ€ìƒì´ ì–¼ë§ˆë‚˜ ë…¸ì¶œë˜ì—ˆëŠ”ì§€ì— ë”°ë¼ ë™ì‘í•˜ê²Œ í•  ìˆ˜ ìˆë‹¤.
- `root`: ê´€ì°° ëŒ€ìƒì´ í™”ë©´ì— ë“¤ì–´ì™”ìŒì„ ê°ì§€í•˜ëŠ” ì˜ì—­ì´ë©°, ê¸°ë³¸ê°’ì€ null(Viewport)ì´ë‹¤.
- `rootMargin`:Â ê´€ì°° ëŒ€ìƒì„ ê°ì§€í•˜ëŠ” ì˜ì—­ì„ ë°”ê¹¥ ë²”ìœ„(Margin)ê¹Œì§€ í™•ì¥í•œë‹¤. ê¸°ë³¸ê°’ì€ ìƒìš°í•˜ì¢Œ ìˆœìœ¼ë¡œ '0px 0px 0px 0px'ì´ë©°, ì˜µì…˜ê°’ì„ ì§€ì •í•  ë•ŒëŠ” ë¬¸ìì—´ë¡œ ë‹¨ìœ„ì™€ í•¨ê»˜ ì‘ì„±í•´ì•¼ í•œë‹¤.
- `threshold`: ê´€ì°° ëŒ€ìƒì´ í™”ë©´ ë‚´ì— ì–¼ë§ˆë‚˜ ë“¤ì–´ ì™”ì„ ë•Œ ì½œë°± í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ì§€ ê²°ì •í•˜ëŠ” ê°’ìœ¼ë¡œ ê¸°ë³¸ê°’ì€ 0(0%)ì´ë©° ìµœëŒ€ 1(100%)ê¹Œì§€ ì§€ì • ê°€ëŠ¥í•˜ë‹¤. ë§Œì•½ 0.6ì´ë©´, ëŒ€ìƒì´ í™”ë©´ì— 60% ì´ìƒ ë³´ì´ê¸° ì‹œì‘í•  ë•Œ ì½œë°± í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤.

```javascript
// ì²«ë²ˆì§¸ ì¸ìëŠ” ì½œë°±í•¨ìˆ˜, ë‘ ë²ˆì§¸ ì¸ìëŠ” ì„¤ì •
const observer = new IntersectionObserver(
  (entries) => {
    entries.forEach((entry) => {
      const { photos, totalCount, isLoading } = this.state;
      // ë¡œë”© ì¤‘ì—ëŠ” ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ì•Šë„ë¡ í•´ì•¼ í•¨
      if (entry.isIntersecting && !isLoading) {
        if (photos.length < totalCount) {
          onScrollEnded();
        }
      }
    });
  },
  {
    // 1ì¸ ê²½ìš° ìŠ¤í¬ë¡¤ì„ ì´ìš©í•´ ê´€ì°° ëŒ€ìƒì´ ëª¨ë‘ ë³´ì¸ ê²½ìš°ì— ì½œë°± í•¨ìˆ˜ê°€ ì‹¤í–‰ëœë‹¤.
    threshold: 1,
  }
);

// ì¤‘ëµ

this.render = () => {
  // ì¤‘ëµ

  let $lastLi = null;

  // ë‹¤ìŒ ê´€ì°° ëŒ€ìƒì„ ë§ˆì§€ë§‰ì˜ ë¦¬ìŠ¤íŠ¸ ìš”ì†Œë¡œ í•œë‹¤.
  const $nextLi = $photos.querySelector("li:last-child");

  if ($nextLi !== null) {
    if ($lastLi !== null) {
      // ë§ˆì§€ë§‰ ìš”ì†Œê°€ nullì¸ ê²½ìš°ì—ëŠ” ê´€ì°°í•˜ì§€ ì•ŠëŠ”ë‹¤.
      observer.unobserve($lastLi);
    }

    $lastLi = $nextLi;
    observer.observe($lastLi); // ê´€ì°° ëŒ€ìƒ ë“±ë¡
  }
};
```
